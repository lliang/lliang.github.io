---
title: 端口
date: 2021-05-09 19:56:48
update: 2021-05-09 19:56:48
urlname: port
tags:
  - Assembly
  - 8086
categories: Assembly
---

## 内存地址空间

各种存储器都和 CPU 的地址线、数据线、控制线相连。
CPU 在操控它们的时候，把它们都当作内存来对待，把它们总地看做一个由若干存储单元组成的逻辑存储器，
我们将这个逻辑存储器称为内存地址空间。

<!-- more -->

## 和总线相连的芯片

1. 各种存储器
2. 各种接口卡（比如，网卡、显卡）上的接口芯片，它们控制接口卡进行工作；
3. 主板上的接口芯片，CPU 通过它们对部分外设进行访问；
4. 其它芯片，用来存储相关的系统信息，或进行相关的输入输出处理。

## 端口定义

和总线相连的芯片都有一组可以由 CPU 读写的寄存器。
这些寄存器物理上可能处于不同的芯片中，但是它们有两个共同点：

1. 都和 CPU 的总线相连，这种连接是通过它们所在的芯片进行的；
2. CPU 对它们进行读或写的时候都通过控制线向它们所在的芯片发出端口读写命令。

从 CPU 的角度，将这些寄存器都当作端口，对它们进行统一编址，从而建立了一个统一的端口地址空间。
每一个端口在地址空间中都有一个地址。

CPU 可以直接读写以下 3 个地方的数据：

1. CPU 内部的寄存器；
2. 内存单元；
3. 端口。

## 端口的读写

- CPU 通过端口地址来定位端口。

- 端口地址通过地址总线传送。

- 在 PC 系统中，CPU 最多可以定位 64KB 个不同的端口
  端口地址的范围为 0 ~ 65535。

### 端口的读写指令

| 指令 |      说明      |
| :--: | :------------: |
|  in  | 从端口读取数据 |
| out  | 往端口写入数据 |

### 总线上的传输信息

<table>
    <tr>
        <th>操作</th>
        <th>指令</th>
        <th>与总线相关的操作</th>
    </tr>
    <tr>
        <td>访问内存</td>
        <td>mov ax,ds:[8]</td>
        <td>
            1. CPU 通过地址线将地址信息 8 发出；<br/>
            2. CPU 通过控制线发出内存读命令，选中存储器芯片，并通知它，将要从中读取数据；<br/>
            3. 存储器将 8 号单元中的数据通过数据线送入 CPU。
        </td>
    </tr>
        <tr>
        <td>访问端口</td>
        <td>in al,60H</td>
        <td>
            1. CPU 通过地址线将地址信息 60H 发出；<br/>
            2. CPU 通过控制线发出端口读命令，选中端口所在的芯片，并通知它，将要从中读取数据；<br/>
            3. 端口所在的芯片将 60H 端口中的数据通过数据线送入 CPU。
        </td>
    </tr>
</table>

### 指定寄存器

**在 in 和 out 指令中，只能使用 ax 或 al 来存放从端口中读入的数据或要发送到端口中的数据。**

- 访问 8 位端口时用 al；
- 访问 16 位端口时用 ax。

对 0 ~ 255 以内的端口进行读写时：

    in al,20H        ;从 20H 端口读入一个字节
    out 20H,al       ;往 20H 端口写入一个字节

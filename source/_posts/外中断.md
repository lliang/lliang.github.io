---
title: 外中断
date: 2021-05-13 18:25:05
update: 2021-05-13 18:25:05
urlname: external-interrupt
tags:
  - Assembly
  - 8086
categories: Assembly
---

## 接口芯片和端口

接口芯片：在 PC 系统的接口卡和主板上安装。

端口：外设接口芯片内部包含的若干寄存器被 CPU 当作端口来访问。

### 端口作用

CPU 通过端口和外部设备进行联系。

1. 接收外设的输入；
   外设的输入不直接送人内存和 CPU，而是送入相关的接口芯片的端口中。
2. 接收 CPU 向外设的输出/控制命令；
   - CPU 向外设的输出不直接送入外设，而是先送入端口中，再由相关的芯片送到外设；
   - CPU 向外设输出的控制命令先送到相关芯片的端口中，然后再由相关的芯片根据命令对外设实施控制。

端口详细信息见[端口](/port.html)

<!-- more -->

## 外中断信息

来自于 CPU 外部的中断信息。

例如：

外设的输入到达端口 ---> 芯片向 CPU 发出相应的中断信息 ---> CPU 执行完当前指令后，检测到发送过来的中断信息 ---> 引发中断过程 ---> 处理外设的输入

外中断源分类：

1. 可屏蔽中断
2. 不可屏蔽中断

### 可屏蔽中断

CPU 可以不响应的外中断，CPU 根据标志寄存器的 IF 位的设置，决定是否响应可屏蔽中断：

- IF = 1：响应可屏蔽中断；
- IF = 0：不响应可屏蔽中断。

中断过程：

1. 取中断类型码 n；
2. 标志寄存器入栈，IF = 0,TF = 0；
3. CS、IP 入栈；
4. (IP) = (n _ 4)，(CS) = (n _ 4 + 2)。

除在第 1 步的实现上有所不同外，基本上和内中断的中断过程相同：

- 可屏蔽中断信息来自于 CPU 外部，中断类型码是通过数据总线送入 CPU 的；
- 内中断的中断类型码是在 CPU 内部产生的。

**中断过程中将 IF 置为 0 的原因：在进入中断处理程序后，禁止其它的可屏蔽中断。**

设置 IF 指令：

- sti：设置 IF = 1;
- cli：设置 IF = 0。

### 不可屏蔽中断

CPU 必须响应的外中断，中断类型码固定为 2。

中断过程：

1. 标志寄存器入栈，IF = 0,TF = 0；
2. CS、IP 入栈；
3. (IP) = (8)，(CS) = (0AH)。

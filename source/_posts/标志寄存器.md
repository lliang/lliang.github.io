---
title: 标志寄存器
date: 2021-05-13 16:26:25
update: 2021-05-13 16:26:25
urlname: flag
tags:
  - Assembly
  - 8086
categories: Assembly
---

作用：

1. 用来存储相关指令的某些执行结果；
2. 用来为 CPU 执行相关指令提供行为依据；
3. 用来控制 CPU 的相关工作方式。

8086 CPU 的标志寄存器有 16 位，其中存储的信息通常被称为程序状态字（PSW）。

标志寄存器是按位起作用的，它的每一位都有专门的含义，记录特定的信息：

| 15  | 14  | 13  | 12  | 11  | 10  |  9  |  8  |  7  |  6  |  5  |  4  |  3  |  2  |  1  |  0  |
| :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: |
|     |     |     |     | OF  | DF  | IF  | TF  | SF  | ZF  |     | AF  |     | PF  |     | CF  |

<!-- more -->

## ZF

说明：标志寄存器第 6 位，零标志位。

作用：记录相关指令执行后，其结果是否为 0：

- 结果为 0， zf = 1；
- 结果不为 0，zf = 0。

## PF

说明：标志寄存器第 2 位，奇偶标志位。

作用：记录相关指令执行后，其结果的所有 bit 位中 1 的个数是否为偶数：

- 1 的个数为偶数，pf = 1；
- 1 的个数为奇数，pf = 0。

## SF

说明：标志寄存器第 7 位，符号标志位。

作用：记录相关指令执行后，其结果是否为负：

- 结果为负，sf = 1；
- 结果非负，sf = 0。

## CF

说明：标志寄存器的第 0 位，进位标志位。

作用：在进行无符号数运算的时候，它记录了运算结果的最高有效位向更高位的进位值，或从更高位的借位值。

- 当两个数据相加的时候，有可能产生从最高有效位向更高位的进位；
- 当两个数据相减的时候，有可能向更高位借位。

## OF

说明：标志寄存器的第 11 位，溢出标志位。

作用：记录了有符号数运算的结果是否发生了溢出：

- 发生溢出，of = 1;
- 没有溢出，of = 0。

## CF 和 OF 的区别

- CF 是对无符号数运算有意义的标志位；
- OF 是对有符号数运算有意义的标志位。

CPU 在执行 add 等指令的时候，就包含了两种含义：无符号数运算和有符号数运算。

无符号数运算，CPU 用 CF 位来记录是否产生了进位；

有符号数运算，CPU 用 OF 位来记录是否产生了溢出，还要用 SF 位来记录结果的符号。

CF 和 OF 所表示的进位和溢出，是分别对无符号数和有符号数运算而言的，它们之间没有任何关系。

## DF

说明：标志寄存器的第 10 位，方向标志位。

作用：在串处理指令中，控制每次操作后 si、di 的增减：

- df = 0 每次操作后 si、di 递增；
- df = 1 每次操作后 si、di 递减。

8086 CPU 提供下面两条指令对 df 位进行设置：

- cld 指令：将标志寄存器的 df 位置 0；
- std 指令：将标志寄存器的 df 位置 1。

## pushf 和 popf

pushf：将标志寄存器的值压栈；

popf：从栈中弹出数据，送入标志寄存器中。

## 标志寄存器在 Debug 中的表示

![标志寄存器在 Debug 中的表示](/uploads/flag-debug.png)

| 标志 | 值为 1 的标记 | 值为 0 的标记 |
| :--- | :------------ | :------------ |
| of   | OV            | NV            |
| sf   | NG            | PL            |
| zf   | ZR            | NZ            |
| pf   | PE            | PO            |
| cf   | CY            | NC            |
| df   | DN            | UP            |
